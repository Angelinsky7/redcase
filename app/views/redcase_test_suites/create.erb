
// Hidding modal dialog
hideModal("modalDiv");

// Removing form to avoid duplicates
$$("#modalDiv form").first().remove();

// @Max: Strange line below. You already hid the dialog. "Toggle" will show it again.
//$("modalDiv").toggle();

// Removing form
// @Max: What is it for? Got an error here as there was no such an element in DOM.
//$("new_redcase_test_suite").remove();

// Calclating padding for the new tree element
// It should be padding of parent three element + 10 px
var parentNodeId = '<%= raw("#{@parent.class}:#{@parent.id}").gsub(/[\n]+/, '').gsub(/["]+/, '\\\"') %>';
var padding = parseInt($(parentNodeId).firstDescendant().getStyle('padding-left')) + 10;

// Adding new tree element
var strRow = "<%= raw(render :partial => 'redcase/test_suite_node', :locals => { :node => @node, :level => 1, :parent => @parent }).gsub(/[\n]+/, '').gsub(/["]+/, '\\\"') %>";

// Applying calculated padding
$(parentNodeId).insert({after: strRow}).next().firstDescendant().setStyle({'padding-left' : padding + 'px'});
